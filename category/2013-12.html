<!doctype html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>荒野丛林 - 2013-12 KenIngle.com</title>

    <link rel="stylesheet" href="/theme/css/main.css">
    <link rel="stylesheet" href="/theme/css/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <div><img src="" class="grv-img"/></div>
        <div class="title"><a href="/">荒野丛林 </a></div>
        <div class="sub-title"></div>

<p>
  <div class="view"><a href="/archives.html">Archives</a></div>
</p>

<!-- Social links -->

      </header>
      <section>
      <div class="front-title"><a href="/gdbdiao-shi-ji-qiao-bi-ji.html">gdb调试技巧笔记</a></div>
<p>
<small>
<abbr class="published" title="2013-12-15T00:00:00">
  日 15 十二月 2013
</abbr> | 
 -- (<a href="/gdbdiao-shi-ji-qiao-bi-ji.html" rel="bookmark">permalink</a>)
</small>
</p>      <p>GDB最基本的几条调试命令不需要再记录。记录些稍微高级点的特性。</p>
<div class="highlight"><pre><span class="mf">1.</span> <span class="err">调试带参数的程序</span>
</pre></div>


<p>在使用gdb调试带参数的程序时，可以使用--args选项。</p>
<div class="highlight"><pre><span class="mf">2.</span> <span class="n">GDB</span><span class="err">调试宏。</span><span class="n">C</span><span class="err">代码在预处理后，宏会被替换，导致在调试最终的可执行文件时，无法找到宏定义。</span>
</pre></div>


<p>gdb编译时，打开-g开关，可以生成调试信息。其实，-g也是有级别(level)的。-g1包含非常少的
调试信息，包含函数及外部变量信息，但是没有行号及局部变量信息。-g2为默认级别，包含行号等
信息。-g3包含更多的信息，比如程序中出现的宏定义信息。macro expand命令和扩展宏，对于调试宏
非常有帮助。可是使用print显示宏替换过后的值，如果宏里面包含有编译时语句，则无法显示出值，比如
宏定义中有static_assert(C11特性,GNU扩展为_Static_assert）。</p>
<div class="highlight"><pre><span class="n">localhost</span> <span class="n">tools</span> <span class="err">#</span> <span class="n">gdb</span> <span class="o">--</span><span class="n">args</span> <span class="p">.</span><span class="o">/</span><span class="n">kmod</span> <span class="o">-</span><span class="n">V</span>
<span class="n">GNU</span> <span class="n">gdb</span> <span class="p">(</span><span class="n">Gentoo ...</span></pre></div> 
      <div class="read-more"><a href="/gdbdiao-shi-ji-qiao-bi-ji.html">read more...</a></div>
      <hr />
      <div class="front-title"><a href="/kmodyuan-ma-yue-du-bi-ji.html">kmod源码阅读笔记</a></div>
<p>
<small>
<abbr class="published" title="2013-12-14T00:00:00">
  六 14 十二月 2013
</abbr> | 
 -- (<a href="/kmodyuan-ma-yue-du-bi-ji.html" rel="bookmark">permalink</a>)
</small>
</p>      <p>kmod<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>是处理Linux内核模块的一系列工具集,可以插入，删除，显示，检查属性，解决模块依赖和创建别名。
取代了module-init-tools。</p>
<h1>程序起始及命令行参数处理</h1>
<p>首先看main函数:</p>
<div class="highlight"><pre><span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="n">err</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">program_invocation_short_name</span><span class="p">,</span> <span class="s">&quot;kmod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">handle_kmod_commands</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">handle_kmod_compat_commands</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>program_invocation_short_name是GNU扩展,表示执行程序时，程序的名称(不包含路径信息)。还有一个
program_invocation_name表示程序的全部名称（包含路径信息），等价于argv[0]。program_invocation_name
使用起来比较方便，不需要硬生生的使用argv[0]。通过man
program_invocation_name可以查看相关信息 ...</p> 
      <div class="read-more"><a href="/kmodyuan-ma-yue-du-bi-ji.html">read more...</a></div>
      <hr />

      </section>
      <footer>
        <p><small>&copy; 荒野丛林 &mdash; Theme based on Sundown by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!-- Scale fix -->
    <script>
      var metas = document.getElementsByTagName('meta');
      var i;
      
      if (navigator.userAgent.match(/iPhone/i)) {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
          }
        }
      
        document.addEventListener("gesturestart", gestureStart, false);
      }

      function gestureStart() {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
          }
        }
      }
    </script>
  </body>
</html>